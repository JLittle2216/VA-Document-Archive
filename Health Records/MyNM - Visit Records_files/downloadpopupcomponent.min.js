/*! Copyright (c) Epic Systems Corporation 2017 */
$$WPUtil.guaranteeExistence($$WP,"Documents.DownloadMyRecord");$$WP.Documents.DownloadMyRecord.DownloadPopupComponent=function $$WP$Documents$DownloadMyRecord$DownloadPopupComponent(a){this.Components$TemplateComponent(a)};$$WP.Documents.DownloadMyRecord.DownloadPopupComponent.prototype={template:$$WP.Templates.Documents.DownloadPopup,downloadCount:null,VDTDownloadPasswordForced:false,show:function WP$Documents$DownloadMyRecord$DownloadPopupComponent$show(){this.Components$TemplateComponent$show()},downloadPopupClick:function WP$Documents$DownloadMyRecord$DownloadPopupComponent$downloadPopupClick(b){var d=true,k="protectionpretext",j="noprotectionpretext",e="disabled",i="#documentpassword",h="li_protect",a=false,c=this,g,f;if(!b)return a;if(b.type==="keypress"&&!(b.keyCode==13||b.keyCode==32))return;g=document.getElementById("li_open");f=document.getElementById(h);$afe.select(i).prop(e,a);switch(b.dataId){case"li_open":handleLiClick(g,f,[j],[k,"usePwd"],a);c.$container.trigger("resize",{forceShrink:d});c.$content.find("#downloadbtn").removeAttr(e).removeClass(e).removeAttr("title").removeAttr("aria-label");return a;case h:handleLiClick(f,g,[k,"usePwd"],[j],d);c.$container.trigger("resize",{forceShrink:d});$afe.select(i).prop(e,a);$$WP.FormValidation.checkIfFormIsValid(c.$content.find("form").first(),d);return a;case"download_button":c.downloadButtonClick(b);return a;case"cancel":c.dispose(d);return a}return},downloadButtonClick:function WP$Documents$DownloadMyRecord$DownloadPopupComponent$downloadButtonClick(){var c="#showondownload",b=this,d,a=b.Data;if(checkDownloadForm(b.VDTDownloadPasswordForced)===true){d=document.getElementById("ccdform");if(d){if(!(navigator.userAgent.indexOf("Chrome")===-1&&navigator.userAgent.indexOf("Safari")>-1)){$$WPUtil.ShowAjaxSpinner($afe.select(c).find(".ajaxspinner"));$afe.select(c).removeClass("hidden");b.$container.trigger("resize",{forceShrink:true})}b._disableDownloadButton(document.getElementById("downloadbtn"));setTimeout(function(){var b="Documents/DownloadMyRecord?ErrorCode=DownloadError";$.ajax({url:a.DownloadButtonLink,type:"POST",data:{mode:a.mode,csn:a.csn,startdate:a.startDate,enddate:a.endDate,doencrypt:$afe.select("#doencrypt").val(),documentpassword:WP.Utils.b64EncodeUnicode($afe.select("#documentpassword").val()),passwordverify:WP.Utils.b64EncodeUnicode($afe.select("#passwordverify").val()),encCount:a.EncCount,encDate:a.EncDate},success:function(a){var c=a.mode;if(c=="success")$$WPUtil.TryRedirect(makeLink("Documents/Released?from=DownloadMyRecord"));else $$WPUtil.TryRedirect(makeLink(b))},error:function(){$$WPUtil.TryRedirect(makeLink(b))}})},0,a)}}},_disableDownloadButton:function WP$Documents$DownloadMyRecord$DownloadPopupComponent$_disableDownloadButton(a){var c="div.section div.sidetab ul.sectiontabs li a",b="div.section div.sidetab ul.sectiontabs li",j,h,i,f,g,k,e,d;j=a.value;f=a.disabled;i=a.className;h=a.style.cursor;g=a.onclick;k=a.title;$afe.select(b).on("click",function(){return false});$afe.select(b).keypress(false);$afe.select(c).css({"text-decoration":"none",cursor:"inherit"});a.disabled=true;a.className+=" disabled";a.style.cursor="default";a.onclick="";e=function(k){var e="#showondownload";if(k==="0"){a.value=j;a.disabled=f;a.className=i;a.style.cursor=h;a.onclick=g;$afe.select(b).off("click");$afe.select(b).off("keypress");$afe.select(c).css({"text-decoration":"",cursor:""});$$WPUtil.HideAjaxSpinner($afe.select(e).find(".ajaxspinner"));$afe.select(e).addClass("hidden");$afe.jq(window).trigger("popupResize")}else d()};d=function(){window.setTimeout(function(){$.ajax(makeLink("Documents/DownloadMyRecord/CheckDownloadProgress"),{success:e,failure:e})},3e3)};d();return true},downloadPopupBlur:function WP$Documents$DownloadMyRecord$DownloadPopupComponent$downloadPopupBlur(){checkDownloadForm(this.VDTDownloadPasswordForced,false)}};$$WP.Documents.DownloadMyRecord.DownloadPopupComponent.extend("Components.TemplateComponent")