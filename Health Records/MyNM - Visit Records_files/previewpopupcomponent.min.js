/*! Copyright (c) Epic Systems Corporation 2016 */
$$WPUtil.guaranteeExistence($$WP,"Documents.DownloadMyRecord");$$WP.Documents.DownloadMyRecord.PreviewPopupComponent=function WP$Documents$DownloadMyRecord$PreviewPopupComponent(a){this.Components$TemplateComponent(a)};$$WP.Documents.DownloadMyRecord.PreviewPopupComponent.prototype={template:$$WP.Templates.Documents.PreviewPopup,IsDownloadActive:true,BaseUrl:"",additionalIFrames:[],setData:function WP$Documents$DownloadMyRecord$PreviewPopupComponent$setData(a){this.Components$TemplateComponent$setData(a)},iframeLoad:function WP$Documents$DownloadMyRecord$PreviewPopupComponent$iframeLoad(b){var a=this;if(b.target.src&&b.target.src.indexOf(a.BaseUrl)!==-1){a.IsDownloadActive=false;$afe.select(".previewPopupMulti .inlineloading").addClass("hidden");$$WPUtil.HideAjaxSpinner($afe.select(".ajaxspinner"));$afe.jq(b.target.parentElement).removeClass("hidden")}a.checkHeight();$afe.jq(window).on("resize",a.checkHeight)},checkHeight:function WP$Documents$DownloadMyRecord$PreviewPopupComponent$checkHeight(){var c="div.ccdiframediv",b="div.previewCCD ul.visitlist,div.previewCCD div.details,div.previewCCD iframe",a;a=parseInt($afe.select("div.previewCCD div.content").css("max-height"),10);if(a<705){$afe.select(b).height(a-10);$afe.select(c).height(a-10)}else{$afe.select(b).css("height","");$afe.select(c).css("height","")}},previewPopupClick:function WP$Documents$DownloadMyRecord$PreviewPopupComponent$previewPopupClick(c){var h="rerenderiframe",f="selected",g="hidden",a=this,j;if(!c||a.IsDownloadActive)return false;if(c.type!=="click"&&c.key!=="Enter"&&c.key!=="Space")return false;if(c.dataId==="selectli"||c.dataId==="selectlianchor"){var d=0;if(c.$target){j=c.$target.closest(".listelement");d=parseInt(j.safeAttr("data-index"),10);if(isNaN(d)||d===-3)return false;var k=a.$content.find(".ccdiframediv.selected");k.addClass(g).removeClass(f);a.checkHeight();var e=a.$content.find(".ccdiframediv[data-index='"+d+"']");e.addClass(f);var l=a.$content.find(".listelement.selected");l.removeClass(f);var n=a.$content.find(".listelement[data-index='"+d+"']");n.addClass(f);var b=e.children("iframe");if(b.length===0){b=dangerou$.parseHtml("<iframe class='iframe'></iframe>");e.prepend(b);b.safeAttr("title",$$WP.Strings.get("PreviewIFrameTitle","documents.downloadmyrecord"));b.on("load",a.iframeLoad.bind(a));a.additionalIFrames.push(b[0]);if(a.additionalIFrames.length>20){var m=a.additionalIFrames.shift();$afe.jq(m).remove()}}else{var i=a.additionalIFrames.indexOf(b[0]);i>=0&&a.additionalIFrames.push(a.additionalIFrames.splice(i,1)[0])}if(!b.safeAttr("src")){$afe.select(".previewPopupMulti .inlineloading").removeClass(g);$$WPUtil.ShowAjaxSpinner($afe.select(".previewPopupMulti .ajaxspinner"));a.IsDownloadActive=true;switch(d){case-2:case-1:b.safeAttr("src",a.Data.daterangeiframesrc);break;default:b.safeAttr("src",a.Data.visitList[d].iframesrc)}}else{e.removeClass(g);if(window.chrome){e.addClass(h);setTimeout(function(){e.removeClass(h)},1)}}}}}};$$WP.Documents.DownloadMyRecord.PreviewPopupComponent.extend("Components.TemplateComponent")