/*! Copyright (c) Epic Systems Corporation 2017-2019 */
$$WPUtil.guaranteeExistence($$WP,"Documents.DownloadMyRecord");$$WP.Documents.DownloadMyRecord.SendPopupComponent=function WP$Documents$DownloadMyRecord$SendPopupComponent(a){this.Components$TemplateComponent(a)};$$WP.Documents.DownloadMyRecord.SendPopupComponent.prototype={_previousTarget:null,_sendingPopup:null,_activeTab:null,template:"",backToProviderList:false,sendOnclick:function WP$Documents$DownloadMyRecord$sendOnClick(g){var C=".sendingspinnerdiv",y="#SearchInfoContent,.formbuttons,.content",d="",m="findprovidersearcherror",x=".stateInput",w=".specialtyInput",v=".firstNameInput",u=".lastNameInput",B="tab_topic_emailAddress",f="#DisplayFindProviderSearchResultsContent",c=true,j="resize",i=".ajaxspinner",h=false,A="Documents/DownloadMyRecord/FindAProvider",k="hidden",l=".loadMoreProvidersPrompt",a=this,b,t,n,q,o,r,E,s,G,O,e,z,K,I,N,L,D,J,H,p,F,M;p=a;if(g){if(g.type==="keyup"&&(g.keyCode!==13||g.which!==13))return;if(g.$target)if(g.$target.hasClass("disabled"))return;switch(g.dataId){case"loadmore":if(a.$content.find(l).hasClass(k)||!a.Data.findProviderEnabled)break;b=a;t=b.Data.DisplayProviders.length;n=b.Data.lastName;q=b.Data.firstName;o=b.Data.state;r=b.Data.specialty;E=b.Data.SearchId;b.Data.TotalNumProviders>t&&$.ajax({url:makeLink(A),type:"POST",dataType:"json",data:{LastName:n,FirstName:q,Specialty:r,State:o,SearchId:E,NumProviderToRetrieve:"6",IndexOfLastProvider:t},success:function(a){if(b.ContainsException(a)){p.dispose();p.ShowErrorPopup(a);return h}$$WPUtil.HideAjaxSpinner(b.$content.find(i));b.$container.trigger(j,{forceShrink:c});p.getMoreProvidersSuccessFunction(a)},failure:function(a){b.sendFailFunction(a)}});s=b.Data.IndexOfNextToGrabProvider;G=s+6;if(b.Data.Providers.length-1<=s){b.Data.IndexOfNextToGrabProvider=-1;b.setData(b.Data);setTimeout(function(){$afe.select(f).focus()},10);b.$content.find(l).addClass(k);$$WPUtil.ShowAjaxSpinner(a.$content.find(i));a.$container.trigger(j,{forceShrink:c});break}else if(a.Data.Providers.length-1>=a.Data.TotalNumProviders){a.Data.IndexOfNextToGrabProvider=-1;a.setData(a.Data);setTimeout(function(){$afe.select(f).focus()},10);a.$content.find(l).addClass(k);$$WPUtil.ShowAjaxSpinner(a.$content.find(i));a.$container.trigger(j,{forceShrink:c});break}a.Data.IndexOfNextToGrabProvider=s;a.setData(a.Data);setTimeout(function(){$afe.select(f).focus()},10);break;case"linkToManualEntry":if(a.template===$$WP.Templates.Documents.SelectProviderSend)a.backToProviderList=c;a.template=$$WP.Templates.Documents.AddressEntrySend;a.Data.emailAddressValidation=new $$WP.FormValidation.ValidationSettings({required:c,isEmail:c,mustMatchField:"confirmEmailAddressInput"});a.Data.confirmEmailAddressValidation=new $$WP.FormValidation.ValidationSettings({required:c,isEmail:c,mustMatchField:"emailAddressInput"});a.Data.directAddressValidation=new $$WP.FormValidation.ValidationSettings({required:c,isEmail:c,mustMatchField:"confirmDirectAddressInput"});a.Data.confirmDirectAddressValidation=new $$WP.FormValidation.ValidationSettings({required:c,isEmail:c,mustMatchField:"directAddressInput"});a.Data.showTabs=a.Data.emailEnabled&&a.Data.directEnabled;a.setData(a.Data);if(a.Data.showTabs){setupTabbedSections();showTabbedSection(B);$$WP.Utilities.UI.NavTabs({});$afe.select("a[name=sendpopuptab]").click(a,a.updateTab);$afe.select("#tab_topic_emailAddress").focus()}else $afe.select("h2.sendPopupHeader").first().focus();a._activeTab=a.Data.emailEnabled?B:"tab_topic_directAddress";$$WP.FormValidation.initializeDOMSubtree($afe.select("#sendPopupTabContent"));$afe.select(".forConfirmation").on("paste",function disablePaste(a){a.preventDefault()});break;case"searchForProviders":D=a.$parent.contentHeight();g.preventDefault();a.template=$$WP.Templates.Documents.SelectProviderSend;e=a.Data;e.lastName=a.$content.find(u)[0].value;e.firstName=a.$content.find(v)[0].value;e.specialty=a.$content.find(w)[0].value;e.state=a.$content.find(x)[0].value;n=e.lastName;q=e.firstName;r=e.specialty;o=e.state;b=a;changeErrorField(m,d);$$WPUtil.ShowAjaxSpinner(a.$content.find(i));a.$content.find(y).hide();a.$parent.innerHeight(D);n!==d&&o!==d&&$.ajax({url:makeLink(A),type:"POST",dataType:"json",data:{LastName:n,FirstName:q,Specialty:r,State:o,SearchId:d,NumProviderToRetrieve:"6",IndexOfLastProvider:0},success:function(a){b.$parent.css("height",d);if(b.ContainsException(a)){b.dispose();b.ShowErrorPopup(a);return h}if(a.TotalNumProviders==="0"){$$WPUtil.HideAjaxSpinner(b.$content.find(i));b.$content.find(y).show();changeErrorField(m,$$WP.Strings.get("NoProviderFoundErrorText","documents.downloadmyrecord"));b.$container.trigger(j,{forceShrink:c})}else{changeErrorField(m,d);b.showProviderList(a.Providers,a)}}});break;case"selectedProvider":z=-1;if(g.$target){F=g.$target.closest(".listOfProviders");z=parseInt(F.safeAttr("data-index"),10)}a.Data.SelectedProvider=a.Data.DisplayProviders[z];if(a.Data.SelectedProvider===undefined)return h;a.template=$$WP.Templates.Documents.ConfirmSelectedProviderSend;a.setData(a.Data);setTimeout(function(){$afe.select("#DisplaySelectedProviderContent").focus()},10);break;case"sendDirectToProvider":e=a.Data;a.submitSendToProvider(a.Data);a.dispose();a._sendingPopup=a.sendPending();$$WPUtil.ShowAjaxSpinner($afe.select(".messageComponent .ajaxspinner"));break;case"sendManualEntry":e=a.Data;a.submitSendToAddress();a.dispose();a._sendingPopup=a.sendPending();break;case"cancel":a.dispose();break;case"backToSearchResults":a.template=$$WP.Templates.Documents.SelectProviderSend;a.setData(a.Data);setTimeout(function(){$afe.select(f).focus()},10);if(a.Data.TotalNumProviders<=a.Data.DisplayProviders.length){$afe.select(C).addClass(k);a.$content.find(l).addClass(k);a.$container.trigger(j,{forceShrink:c})}break;case"back":if(a.template===$$WP.Templates.Documents.AddressEntrySend&&a.backToProviderList){a.backToProviderList=h;a.template=$$WP.Templates.Documents.SelectProviderSend;a.setData(a.Data);setTimeout(function(){$afe.select(f).focus()},10);if(a.Data.TotalNumProviders<=a.Data.DisplayProviders.length){$$WPUtil.ShowAjaxSpinner($afe.select(C));a.$content.find(l).addClass(k)}return h}a.template=$$WP.Templates.Documents.SearchProviderSend;a.setData(a.Data);setTimeout(function(){$afe.select("#popup").focus()},10);$afe.select(u).keyup(a.sendOnchange);$afe.select(v).keyup(a.sendOnchange);$afe.select(w).change(a.sendOnchange);$afe.select(x).change(a.sendOnchange);$afe.select(u).val(a.Data.lastName);$afe.select(v).val(a.Data.firstName);$afe.select(w).val(a.Data.specialty);$afe.select(x).val(a.Data.state);a.Data.lastName=d;a.Data.firstName=d;a.Data.specialty=d;a.Data.state=d;$$WP.FormValidation.initializeDOMSubtree($afe.select("#sendProviderSendForm"))}}},sendOnchange:function WP$Documents$DownloadMyRecord$SendPopupComponent$sendOnchange(){var a;switch($afe.jq(this).safeAttr("data-id")){case"lastNameForSearch":case"firstNameForSearch":case"specialtyForSearch":case"stateForSearch":default:WP.DOM.Browser.isIE&&$afe.select("#sendProviderSendForm").trigger("click")}},sendPending:function WP$Documents$DownloadMyRecord$SendPopupComponent$sendPending(){var b,a;b=$$WP.Templates.UI.AjaxSpinner({inline:1});a=new $$WPComp.MessageComponent({TitleText:$$WP.Strings.get("SendPopupTitle","documents.downloadmyrecord"),Message:b});return $$WPUtil.quickPopup(a)},submitSendToAddress:function WP$Documents$DownloadMyRecord$SendPopupComponent$submitSendToAddress(){var j="disabled",e=this,f,i,g,c,d,h,b,a;b=e.Data;g=b.Csn;c=b.StartDate;d=b.EndDate;if(b.ActiveView==="singleVisitView"){f="EncounterWithLucy";c="";d=""}else{f="DateRangeMany";g="";if(b.ActiveView==="allVisitsView"){c="";d=""}}if(e._activeTab=="tab_topic_directAddress"){h=1;i=$afe.select("#directAddressInput").val().trim()}else{h=2;i=$afe.select("#emailAddressInput").val().trim()}a=e;e.$content.find(".sendManualEntryButton").addClass(j).prop(j,true);$.ajax({url:makeLink("Documents/DownloadMyRecord/TransmitVisits"),type:"POST",dataType:"json",data:{RequestType:f,Address:i,MethodOfTransmit:h,CSN:g,StartDate:c,EndDate:d},success:function(b){a._sendingPopup.dispose();if(a.ContainsException(b)){a.ShowErrorPopup(b);return false}a.sendSuccessFunction(b)},failure:function(b){a._sendingPopup.dispose();a.sendFailureFunction(b)}});return true},submitSendToProvider:function WP$Documents$DownloadMyRecord$SendPopupComponent$submitSendToProvider(a){var g="disabled",e,f,c,d,i,h,j;f=a.Csn;c=a.StartDate;d=a.EndDate;i=1;if(a.ActiveView==="singleVisitView"){e="EncounterWithLucy";c="";d=""}else{e="DateRangeMany";f="";if(a.ActiveView==="allVisitsView"){c="";d=""}}if(a.SelectedProvider!==null&&a.SearchId!==null){j=a.SelectedProvider.ProviderIndex;h=a.SearchId}var b=this;this.$content.find(".sendDirectToProviderButton").addClass(g).prop(g,true);$.ajax({url:makeLink("Documents/DownloadMyRecord/TransmitVisits"),type:"POST",dataType:"json",data:{RequestType:e,MethodOfTransmit:i,CSN:f,StartDate:c,EndDate:d,Node:h,Index:j},success:function(a){b._sendingPopup.dispose();if(b.ContainsException(a)){b.ShowErrorPopup(a);return false}b.sendSuccessFunction(a)},failure:function(a){b._sendingPopup.dispose();b.sendFailureFunction(a)}});return true},sendSuccessFunction:function WP$Documents$DownloadMyRecord$SendPopupComponent$sendSuccessFunction(c){var a="documents.downloadmyrecord",b;if(c.StatusCode===1){this.dispose();b=new $$WPComp.MessageComponent({TitleText:$$WP.Strings.get("SendPopupTitle",a),Message:$$WP.Strings.get("SendSuccessText",a),ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WP.Strings.get("OkayButtonText",a),null,"cancel","")]});$$WPUtil.quickPopup(b)}},sendFailFunction:function WP$Documents$DownloadMyRecord$SendPopupComponent$sendFailFunction(){var a="documents.downloadmyrecord";this.dispose();var b=new $$WPComp.MessageComponent({TitleText:$$WP.Strings.get("SendPopupTitle",a),Message:$$WP.Strings.get("SendFailText",a),ToolbarButtons:[new $$WPComp.ComplexObjects.Button($$WP.Strings.get("OkayButtonText",a),null,"cancelworkflow","")]});$$WPUtil.quickPopup(b)},showProviderList:function WP$Documents$DownloadMyRecord$SendPopupComponent$showProviderList(d,b){var e=this,c;if(d!==null&&d!==undefined)if(d.length>0){b.HasNoData=false;b.Providers=d}else b.HasNoData=true;else b.HasNoData=true;var a=e.Data;a.Providers=b.Providers;a.DisplayProviders={};if(a.Providers!==null){if(a.Providers.length<=6)a.DisplayProviders=a.Providers;else for(c=0;c<6;c++)a.DisplayProviders[c]=a.Providers[c];if(b.TotalNumProviders<=a.Providers.length)a.IndexOfNextToGrabProvider=-1;else a.IndexOfNextToGrabProvider=6}a.SearchId=b.SearchId;a.TotalNumProviders=b.TotalNumProviders;a.HasNoData=b.HasNoData;e.setData(a);setTimeout(function(){$afe.select("#DisplayFindProviderSearchResultsContent").focus()},10);if(a.IndexOfNextToGrabProvider===-1){$afe.select(".sendingspinnerdiv").addClass("hidden");e.$content.find(".loadMoreProvidersPrompt").addClass("hidden");e.$container.trigger("resize",{forceShrink:true})}},getMoreProvidersSuccessFunction:function WP$Documents$DownloadMyRecord$SendPopupComponent$getMoreProvidersSuccessFunction(d){var c=this,a,b;if(d.Providers!==null&&d.Providers!==undefined){a=c.Data;a.Providers=d.Providers;var e=a.DisplayProviders.length;for(b=0;b<6;b++)if(a.Providers[b])a.DisplayProviders[b+e]=a.Providers[b];else break;a.IndexOfNextToGrabProvider=a.DisplayProviders.length-1}c.setData(a);setTimeout(function(){$afe.select("#DisplayFindProviderSearchResultsContent").focus()},10);if(a.TotalNumProviders<=a.DisplayProviders.length){$afe.select(".sendingspinnerdiv").addClass("hidden");c.$content.find(".loadMoreProvidersPrompt").addClass("hidden");c.$container.trigger("resize",{forceShrink:true})}},updateTab:function WP$Documents$DownloadMyRecord$SendPopupComponent$updateTab(b){var a;a=b.data;a._activeTab=b.currentTarget.getAttribute("data-id")}};$$WP.Documents.DownloadMyRecord.SendPopupComponent.extend("Components.TemplateComponent")