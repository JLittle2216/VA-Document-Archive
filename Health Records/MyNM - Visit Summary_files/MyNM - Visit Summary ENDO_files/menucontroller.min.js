!function ClassDefinition(){var e=$$WP.Controllers.Controller,t=function WP$Navigation$MenuController(e,t,n,i){this.$root=e,this.callbackFunction=t,this.template=$$WP.Templates.Navigation.Menu,this.searchTemplate=$$WP.Templates.Navigation.MenuSearch,this.proxify("_onMenuLoaded","_toggleMenu","_onMenuButtonKeydown","_doSearch","__afterHideMenuShield","__setFocusOnMenuOpen","_onSearchEmptyButtonClicked","__handleThrottledUserScroll","__onUserFinishedTyping","__onMenuItemSelected"),this.MenuName=i,this.SearchAuditTrail=[],$.get({url:makeLink(n),success:this._onMenuLoaded})};t.prototype={$root:null,$menuRoot:null,$searchRoot:null,$searchEmptyButton:null,$menuShield:null,$menuSearchBar:null,$menuContainer:null,$menuButton:null,userFinishedTypingTimer:null,menu:null,template:null,searchTemplate:null,callbackFunction:null,eventListenerFunctionProxy:null,ShouldAudit:null,CurrentSearchData:null,SearchAuditTrail:null,skipLoggingClosed:null,pendingEventType:null,blocksDownArrow:null,_onMenuLoaded:function WP$Navigation$MenuController$_onMenuLoaded(e){if(this.menu=new $$WP.Navigation.Models.Menu(e),this.menu.MenuName=this.MenuName,this._render(),this.ShouldAudit=this.menu.IsNav&&e.ShouldAudit,"function"==typeof this.callbackFunction){var t={};t.ButtonDisplayName=this.menu.MenuDisplayName;var n=[];if(this.menu.Shortcuts&&this.menu.Shortcuts.length>0)for(var i=0;i<this.menu.Shortcuts.length;i++){var s=this.menu.Shortcuts[i];s.URL=s.Link,n.push(s)}t.Shortcuts=n,this.callbackFunction(t)}},_render:function WP$Navigation$MenuController$_render(){$afe.select("#"+this.MenuName+"Wrapper").safeAppend($afe.renderTemplate(this.template,this.menu,{})),this.$menuRoot=$afe.select("#"+this.MenuName+"-list"),this.$searchRoot=$afe.select("#"+this.MenuName+"-searchlist"),this.$menuShield=$afe.select("#"+this.MenuName+"-shield"),this.$menuShield.on("click",this._toggleMenu),this.$menuSearchBar=$afe.select("#"+this.MenuName+"-searchbar"),this.$menuSearchBar.on("input",this._doSearch),this.$menuContainer=$afe.select("#"+this.MenuName+"-container"),this.$menuButton=$afe.select("#"+this.MenuName),this.$searchEmptyButton=$afe.select("#"+this.MenuName+"-searchemptybutton"),$afe.select("#"+this.MenuName+"-closebutton").on("click",this._toggleMenu),$afe.select("#"+this.MenuName+"-responsiveclosebutton").on("click",this._toggleMenu),this.$root.on("click",this._toggleMenu),this.$root.on("keydown",this._onMenuButtonKeydown),$afe.select("."+this.MenuName+".menuitem-content").on("click",this.__onMenuItemSelected),this.$searchEmptyButton.on("click",this._onSearchEmptyButtonClicked),$$WPUtil.AddImmediateThrottledListener(this.$menuRoot,"scroll","",2e3,this.__handleThrottledUserScroll),$$WPUtil.AddImmediateThrottledListener(this.$searchRoot,"scroll","",2e3,this.__handleThrottledUserScroll)},__onMenuItemSelected:function WP$Navigation$MenuController$__onMenuItemSelected(e){var t=e.currentTarget.id.split("_")[0],n=0===e.originalEvent.detail?"k":"m";this.__logMenuEvent("MenuSelected",t,n),this.skipLoggingClosed=!0,this._toggleMenu()},_onMenuButtonKeydown:function WP$Navigation$MenuController$_onMenuButtonKeydown(e){switch(e.keyCode){case 32:case 13:event.preventDefault(),this._toggleMenu()}},_toggleMenu:function WP$Navigation$MenuController$_toggleMenu(){this.$menuContainer.hasClass("menu-open")?this._closeMenu():this._openMenu()},_openMenu:function WP$Navigation$MenuController$_openMenu(){this.eventListenerFunctionProxy=$.proxy(this._handleMenuKeydown,this),this._preOpenMenu(),"menu"===this.MenuName&&($$WP.Utilities.UI.ToggleBodyScrolling(!0),this.__setAriaHiddenForPage(!0)),this.$menuContainer.show().addClass("menu-open"),this.$menuButton.addClass("menu-rootopen"),this.$menuButton.safeAttr("aria-expanded","true"),this.$menuShield.show().addClass("menu-shieldopen"),this.$menuContainer.on("keydown",this.eventListenerFunctionProxy),this.$menuButton.on("keydown",this.eventListenerFunctionProxy),this.__logMenuEvent("MenuOpened"),setTimeout(this.__setFocusOnMenuOpen,0)},__setFocusOnMenuOpen:function(){var e=$afe.select("#"+this.MenuName+"-responsiveclosebutton:visible");0===e.length&&(e=window.outerWidth<769&&"menu"!=this.MenuName?this.$menuButton:this.$menuSearchBar),e.focus()},_closeMenu:function WP$Navigation$MenuController$_closeMenu(e){this.__logPendingEvent(),clearTimeout(this.userFinishedTypingTimer),this.skipLoggingClosed||this.__logMenuEvent("MenuClosed"),this.skipLoggingClosed=!1,this.$menuContainer.removeClass("menu-open").off("keydown",this.eventListenerFunctionProxy),this.$menuShield.removeClass("menu-shieldopen"),this.$menuButton.removeClass("menu-rootopen").off("keydown",this.eventListenerFunctionProxy).safeAttr("aria-expanded","false"),"menu"===this.MenuName&&$$WP.Utilities.UI.ToggleBodyScrolling(!1),setTimeout(this.__afterHideMenuShield,100)},_preOpenMenu:function(){var e=$afe.select(".menu-rootopen")[0];if(void 0!==e){var t="#"+e.id;this.__logPendingEvent(),clearTimeout(this.userFinishedTypingTimer),$afe.select(".menu-button").off("keydown",this.eventListenerFunctionProxy),$afe.select(".menu-container").off("keydown",this.eventListenerFunctionProxy),$afe.select(".menu-open").hide().removeClass("menu-open"),$afe.select(".menu-shieldopen").hide().removeClass("menu-shieldopen"),$afe.select(".menu-rootopen").removeClass("menu-rootopen").safeAttr("aria-expanded","false"),$afe.select(t+"-list").scrollTop(0),$afe.select(t+"-searchbar").val(""),$afe.select(t+"-searchresultstotal").empty(),$afe.select(t+"-ariasearchresultstotal").empty(),$afe.select(t+"-searchemptybutton").hide(),$afe.select(t+"-searchlist").hide(),$afe.select(t+"-list").show()}},__afterHideMenuShield:function(){$afe.select("body");0===$afe.select(".lightbox_overlay:visible").length&&("menu"===this.MenuName&&this.__setAriaHiddenForPage(!1),this.$root.focus()),this.$menuRoot.scrollTop(0),this.$menuSearchBar.val(""),this._clearSearch(!0),this.$menuContainer.hide(),this.$menuShield.hide()},_handleMenuKeydown:function WP$Navigation$MenuController$_handleMenuKeydown(e){switch(e.keyCode){case 8:this.__handleMenuBackspace(e);break;case 9:this.__handleMenuTab(e);break;case 27:this._closeMenu();break;case 38:e.preventDefault(),this.__handleMenuUpArrow(e.target);break;case 40:e.preventDefault(),this.__handleMenuDownArrow(e.target);break;case 36:"menu-searchbar"!==e.target.id&&$afe.select(".menuitem-content:visible").first().focus();break;case 35:"menu-searchbar"!==e.target.id&&$afe.select(".menuitem-content:visible").last().focus()}},__handleMenuBackspace:function(e){"INPUT"!==e.target.tagName&&e.preventDefault()},__handleMenuTab:function(e){var t="#"+this.MenuName+"-container ",n=$afe.select(t+"button:not([disabled]), "+t+"input:not([disabled],[type='hidden']), "+t+"a[href]:visible, "+t+"div[tabindex=0]:visible"),i=n[0],s=n[n.length-1];"none"===$afe.jq(i).css("display")&&("undefined"!==(i=i=$afe.select("#"+this.MenuName+"-responsiveclosebutton")[0])&&"none"!==$afe.jq(i).css("display")||(i=this.$menuButton[0])),e.shiftKey?document.activeElement===i&&(s.focus(),e.preventDefault()):document.activeElement===s&&(i.focus(),e.preventDefault()),"menu-searchbar"===e.target.id&&this.__logMenuEvent("KeyboardExitSearch")},__handleMenuDownArrow:function(e){if(!this.blocksDownArrow){var t=$afe.jq(e);if("menu-searchbar"===e.id&&this.__logMenuEvent("KeyboardExitSearch"),t.hasClass("menuitem-content")){var n=t.parent().next().find(".menuitem-content");0===n.length?t.closest(".submenu").next().find(".menuitem-content").first().focus():n.focus()}else WP.DOM.Browser.isChrome||WP.DOM.Browser.isChromiumEdge?(this.blocksDownArrow=!0,setTimeout(function(){$afe.select(".menuitem-content:visible").first().focus(),this.blocksDownArrow=!1}.bind(this),300)):$afe.select(".menuitem-content:visible").first().focus()}},__handleMenuUpArrow:function(e){var t=$afe.jq(e),n=t.parent().prev().find(".menuitem-content");0===n.length&&0===(n=t.closest(".submenu").prev().find(".menuitem-content").last()).length?this.$menuSearchBar.focus():n.focus()},__handleThrottledUserScroll:function(){this.__logMenuEvent("UserScrolled")},__setAriaHiddenForPage:function(e){$afe.select("#header").safeAttr("aria-hidden",e),$afe.select("#footer").safeAttr("aria-hidden",e),$afe.select("#content").safeAttr("aria-hidden",e),$afe.select("#toastWrapper").safeAttr("aria-hidden",e)},_onSearchEmptyButtonClicked:function $WP$Navigation$MenuController$_onEmptySearchButtonClicked(){this.$menuSearchBar.val("").focus(),this._clearSearch()},_doSearch:function $WP$Navigation$MenuController$_doSearch(e){$afe.select("#"+this.MenuName+"-ariasearchresultstotal").empty();var t=e.target.value;t=t.replaceAll("-"," ").toLowerCase().trim();var n=!!this.CurrentSearchData&&this.CurrentSearchData.SearchString.startsWith(t);(n&&"InputDeleted"!==this.pendingEventType||!n&&"InputEntered"!==this.pendingEventType)&&this.__logPendingEvent(),clearTimeout(this.userFinishedTypingTimer),null!==t&&""!==t?(this.$menuRoot.hide(),this.$searchRoot.empty(),this.CurrentSearchData=new $$WP.Navigation.Models.SearchMenu(this.menu,t,this.ShouldAudit),this.CurrentSearchData.SearchResultsDisplay=this.__getDisplayNumSearchMatches(this.CurrentSearchData.TotalMatches),this.userFinishedTypingTimer=setTimeout(this.__onUserFinishedTyping,500,n),this.pendingEventType=n?"InputDeleted":"InputEntered",this.$searchRoot.safeAppend($afe.renderTemplate(this.searchTemplate,this.CurrentSearchData,{})),this.$searchEmptyButton.show(),this.$searchRoot.show(),this.$menuContainer.off("keydown",this.eventListenerFunctionProxy),this.eventListenerFunctionProxy=$.proxy(this._handleMenuKeydown,this),this.$menuContainer.on("keydown",this.eventListenerFunctionProxy),$afe.select("#"+this.MenuName+"-searchlist ."+this.MenuName+".menuitem-content").on("click",this.__onMenuItemSelected)):this._clearSearch()},_clearSearch:function WP$Navigation$MenuController$_clearSearch(e){$afe.select("#"+this.MenuName+"-ariasearchresultstotal").empty(),this.__logPendingEvent(),clearTimeout(this.userFinishedTypingTimer),this.$menuContainer.off("keydown",this.eventListenerFunctionProxy),this.$searchRoot.hide(),this.$menuRoot.show(),this.CurrentSearchData=null,e||this.__logMenuEvent("InputCleared");var t=$afe.select("#"+this.MenuName+"-searchemptybutton");setTimeout((function(){t.hide()}),50),this.eventListenerFunctionProxy=$.proxy(this._handleMenuKeydown,this),this.$menuContainer.on("keydown",this.eventListenerFunctionProxy)},__getDisplayNumSearchMatches:function(e){var t="";switch(e){case 0:t=$$WP.Strings.get("MenuSearchNoResults","Navigation.Menu");break;case 1:t=$$WP.Strings.get("MenuSearchOneResult","Navigation.Menu");break;default:$$WP.Strings.addMnemonic("@MYCHART@NUMSEARCHMATCHES@",e,!1,"Navigation.Menu"),t=$$WP.Strings.get("MenuSearchMultipleResults","Navigation.Menu"),$$WP.Strings.removeMnemonic("@MYCHART@NUMSEARCHMATCHES@","Navigation.Menu")}return t},__onUserFinishedTyping:function(e){$afe.select("#menu-ariasearchresultstotal").text(this.CurrentSearchData.SearchResultsDisplay);var t=e?"InputDeleted":"InputEntered";this.pendingEventType===t&&(this.__logMenuEvent(t),this.pendingEventType=null)},__logPendingEvent:function(){null!==this.pendingEventType&&(this.__logMenuEvent(this.pendingEventType),this.pendingEventType=null)},__logMenuEvent:function(e,t,n){if(this.ShouldAudit){this.pendingEventType!==e&&this.__logPendingEvent();var i={};i.Action=e,i.ChangesMenuState=this.__eventChangesMenuState(e),i.CurrentLocale=$$WP.CurrentLocale?$$WP.CurrentLocale.Identifier:"NA";var s=new Date(Date.now());if(i.OccurredAt=s.getTime(),this.CurrentSearchData&&(i.SearchTerm=this.CurrentSearchData.SearchString.substring(0,500),this.__eventLogsMenus(e)&&(i.MenuItems=this.CurrentSearchData.AuditState)),t&&(i.SelectedMenuItem={Id:t,SelectionMethod:n,SynonymMatch:this.CurrentSearchData?this.__getSynonymMatch(t):""}),this.SearchAuditTrail||(this.SearchAuditTrail=[]),this.SearchAuditTrail.push(i),this.__eventIsTerminal(e)||this.SearchAuditTrail.length>5){var a=this.SearchAuditTrail;getCSRFTokenAsQS((function(){$.ajax({type:"POST",url:makeLink("Menu/Menu/Audit"),data:JSON.stringify({events:a}),contentType:"application/json;",dataType:"text"})})),this.SearchAuditTrail=null}}},__getSynonymMatch:function(e){for(menuInd=0;menuInd<this.CurrentSearchData.AuditState.length;menuInd++)if(this.CurrentSearchData.AuditState[menuInd].Id===e)return this.CurrentSearchData.AuditState[menuInd].SynonymMatch},__eventChangesMenuState:function(e){switch(e){case"MenuOpened":case"InputEntered":case"InputDeleted":case"InputCleared":return!0;default:return!1}},__eventLogsMenus:function(e){switch(e){case"InputEntered":case"InputDeleted":return!0;default:return!1}},__eventIsTerminal:function(e){return"MenuSelected"===e||"MenuClosed"===e}},$$WP.Navigation=$$WP.Navigation||{},$$WP.Navigation.MenuController=t,t.extend(e,"WP$Navigation$MenuController")}();