!function ClassDefinition(){$$WP.Utilities.guaranteeExistence($$WP,"ProxySwitch.Controllers");var e=function WP$ProxySwitch$Controllers$ProxyPopupMenuController(e,t){this.$root=e,this.parentController=t,this.menuitems=[],childElements=this.$root.find("li");var s=this;childElements.each((function(e,t){t.children.length<1||(menuElement=t.children[0],!menuElement||"A"!==menuElement.tagName.toUpperCase()&&"DIV"!==menuElement.tagName.toUpperCase()||(s.menuitems.push(menuElement),menuElement.onclick=s._handleClick.bind(s,menuElement),t.onkeydown=s._handleKeydown.bind(s,t)))}));var n=this.menuitems.length;n>0&&(this.firstItem=this.menuitems[0],this.lastItem=this.menuitems[n-1]),this.keyCode={TAB:9,RETURN:13,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40}};e.prototype={$root:null,parentController:null,menuitems:null,firstChars:null,firstItem:null,lastItem:null,hasFocus:!1,currentItem:null,destroy:function(){childElements=this.$root.find("li");childElements.each((function(e,t){t.children.length<1||(menuElement=t.children[0],!menuElement||"A"!==menuElement.tagName.toUpperCase()&&"DIV"!==menuElement.tagName.toUpperCase()||(menuElement.onclick=null,t.onkeydown=null))})),this.menuitems=null},setFocusToController:function(){this.parentController.$menuButton.focus()},setFocusToFirstItem:function(){this.firstItem.focus(),this.currentItem=this.firstItem},setFocusToLastItem:function(){this.lastItem.focus(),this.currentItem=this.lastItem},setFocusToPreviousItem:function(){var e;this.currentItem===this.firstItem?this.setFocusToLastItem():(e=this.menuitems.indexOf(this.currentItem),this.menuitems[e-1].focus(),this.currentItem=this.menuitems[e-1])},setFocusToNextItem:function(){var e;this.currentItem===this.lastItem?this.setFocusToFirstItem():(e=this.menuitems.indexOf(this.currentItem),this.menuitems[e+1].focus(),this.currentItem=this.menuitems[e+1])},returnFocusToItem:function(e){var t=this.menuitems.findIndex(this.findMenuItemByDataId,e);-1!==t?(this.menuitems[t].focus(),this.currentItem=this.menuitems[t]):this.setFocusToFirstItem()},findMenuItemByDataId:function(e,t,s){return $afe.jq(e).data("id")==this},_removeLinks:function(e){this.menuitems.forEach((function(t){t.href!==e&&(t.href="#")}))},_handleClick:function(e,t){"true"===e.dataset.closedropdown?(this.setFocusToController(),this.parentController.closeProxyDropdown(),t.stopImmediatePropagation()):e.href&&"#"!==e.href&&"true"===e.dataset.switchpatients&&$$WPUtil.SafeToRedirect((function(t){t&&($$WPUtil.TryRedirect(e.href),$afe.select(".proxySubjectLink").removeAttr("href"),$afe.select(".proxySubjectLink").removeAttr("onclick"),$afe.select("#itemFeedContainer a").removeAttr("href"),$afe.select("#itemFeedContainer a").removeAttr("onclick"))}))},_handleKeydown:function(e,t){var s=!1;if(!(t.ctrlKey||t.altKey||t.metaKey)){if(t.shiftKey)t.keyCode===this.keyCode.TAB&&(this.setFocusToPreviousItem(this),s=!0);else switch(t.keyCode){case this.keyCode.ESC:return this.setFocusToController(),void this.parentController.closeProxyDropdown();case this.keyCode.UP:this.setFocusToPreviousItem(this),s=!0;break;case this.keyCode.DOWN:case this.keyCode.TAB:this.setFocusToNextItem(this),s=!0;break;case this.keyCode.HOME:case this.keyCode.PAGEUP:this.setFocusToFirstItem(),s=!0;break;case this.keyCode.END:case this.keyCode.PAGEDOWN:this.setFocusToLastItem(),s=!0;break;case this.keyCode.RETURN:case this.keyCode.SPACE:e.firstElementChild.click(),s=!0}s&&(t.stopPropagation(),t.preventDefault())}}},$$WP.ProxySwitch.Controllers.ProxyPopupMenuController=e,e.extend($$WP.Controllers.Controller,"WP$ProxySwitch$Controllers$ProxyPopupMenuController")}();